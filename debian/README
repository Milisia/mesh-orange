Debian ramdisk builder
----------------------

This directory contains an auto-build system for making bootable disk
images using a ramdisk images.  It is tested and known to work when run
on a Debian system.  It requires that you are running a system with the
apt and dpkg software.  See below for building on Debian.

There is nothing particularly Orange PI Zero specific about the created
ramdisk image, it should work on any system supported by the Debian armhf
architecture, however the bootable disk is specific to the Allwinner
boot loader layout (It might be usable on other Allwinner CPUs if the
right device-tree is added, but testing is needed)

It currently only creates a very minimal debian system (the config file
debian.stretch.multistrap contains the list of repositories and the
packages to install)

Usage:

    make build-depends          # install needed build packages

    make                        # full build
                                # - creates build/sun8i-h2plus-orangepi-zero.img

After making sure the needed packages are installed, you just need to
run the full build.  Once the full disk image output file is generated,
use "dd" (or similar) to write the image to the raw sdcard.

Booting and using the system
----------------------------

The image has a default root password of "root" - however, this is
expected to change before use in production (probably by adding a
boot-time configuration script)

It is very helpful to use a serial console to log in, but if the ethernet
port is plugged into a network, it should autoconfigure an IP address
which can be pinged and sshed to.  During testing, it might be useful
to read the section below on running this image in an emulator.

NOTE: uncompressing the (currently approximately 120Meg uncompressed) initrd
will take a noticable amount of time.  The network will not be setup until
that has been done, so nothing will happen for a while.  For some reason, this
also applies to the kernel messages.

Tests on one orange pi zero show that the time from power on until a login
prompt on the serial console is about 1 minute.


Building on Ubuntu
------------------

During building, all downloaded Debian packages are verified before use.  This
verification requires the Debian keyring to work.  When using Ubuntu, the
Debian keyring is not installed by default.  The following command will install
the Debian keyring package and allow the verification:

    sudo apt-get install debian-archive-keyring

Optional partial build targets:
-------------------------------

    make debian                 # build a Debian armhf chroot in build/debian
    make build/boot/uInitrd     # build the u-boot initrd
    make boot                   # build a full /boot dir in build/boot

For testing purposes, it might be useful to create a partial build using
one of these targets.  The dependancies between these three targets are
all working - so that asking for the "boot" target will automatically
generate the uInitrd and the debian base install" as needed.

To test the ramdisk image (build/boot/uInitrd), first create a bootable
armbian sdcard.  Mount this card and overwrite the boot/uInitrd file
with the one built above.

To test the boot dir, first create a bootable armbian sdcard.  Mount this
card and remove the boot dir from it, copy the build/boot dir onto
the card.

Test the debian image in an emulator:
-------------------------------------
It is possible to perform some basic testing of the debian image using the
Qemu emulator.

* Testing with armhf

  Ensure you have the "qemu-system-arm" package installed and then:

    make test-arm_virt

* Testing with i386

  This emulation is much faster, which is why it is worth using on a project
  that is expected to not normally run on i386

  Ensure you have the "qemu-system-x86" package installed and then:

    make CONFIG_DEBIAN_ARCH=i386 test-i386_virt

