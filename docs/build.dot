#
# Outline how the build process works
#

digraph g{

    subgraph cluster_debian {
        debian_minimal_builder [shape=plaintext];
        graph[style=dotted];
        color=blue;

        debian_minimal_builder -> debian_minimal_builder_repo [dir=none style=invisible];
        debian_minimal_builder -> local_overrides [dir=none style=invisible];

        debian_minimal_builder_repo [shape=folder];
        local_overrides [shape=note];
        minimal_initrd [shape=box3d];

        debian_minimal_builder_repo -> minimal_initrd;

        local_overrides -> minimal_initrd;

    }
    
    subgraph cluster_kernel {
        kernel [shape=plaintext];
        graph[style=dotted];
        color=blue;

        kernel_config [shape=note];
        mainline_source [shape=folder];
        kernel_patches [shape=folder];
        kernel_source [shape=folder];
        kernel_image [shape=box3d];
        modules [shape=folder];
        dtb [shape=folder];

        kernel_patches -> kernel_source;
        mainline_source -> kernel_source;
        kernel_source -> kernel_build;
        kernel_config -> kernel_build;

        kernel_build -> github_release -> kernel_image;
        github_release -> modules;
        github_release -> dtb;
    }

    upstream_firmware [shape=folder];
    firmware [shape=folder];
    upstream_firmware -> firmware;

    cjdns_deb [shape=folder];
    cjdns_extract [shape=folder];
    cjdns_deb -> cjdns_extract;

    subgraph cluster_boot {
        boot [shape=plaintext];
        graph[style=dotted];
        color=blue;

        initrd [shape=box3d];
        conf_d [label="conf.d" shape=folder];
        spl [shape=note];
        uboot [shape=note];
        uboot_config [shape=folder];

        spl -> disk_image;
        uboot -> disk_image;
        uboot_config -> disk_image;
        initrd -> disk_image;
        conf_d -> disk_image;
        dtb -> disk_image;
    }

    firmware -> initrd;
    minimal_initrd -> initrd;
    modules -> initrd;
    cjdns_extract -> initrd;
    kernel_image -> disk_image;

    disk_image [shape=box3d];
    sdcard [shape=folder];
    disk_image -> sdcard;
}

